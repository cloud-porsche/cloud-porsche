import{_ as O}from"./ProTier-WEItR_0B.js";import{d as A,H as D,e as C,f as j,g as V,r as H,h as L,i as b,o as S,j as B,k as r,w as u,l as $,u as i,m as M,n as g,v as z,V as N,b as m,p as I,q as P,s as E,a as F,T as R,x as _,y as v}from"./index-BPprRNqh.js";import{V as U}from"./VSelect-BoUmtaYN.js";import"./VChip-DRVAF1qL.js";const Q=A({__name:"index",setup(W){D.setOptions({chart:{styledMode:!0}});const p=C(),e=j(),x=V(()=>p.isDark),h=[{value:"weekly",label:"Last week"},{value:"monthly",label:"Last month"},{value:"yearly",label:"Last year"},{value:"total",label:"Total"}],o=H(e.timeframe);function l(t,a,s,n=!0){var y;let f=s>=0?"green":"red";n||(f="transparent");const c=d=>d.toFixed(0),k=s>=0?`+${c(s)}%`:`${c(s)}%`;return`
    <div class="custom_card">
      <div class="custom_card-header">${t}</div>
      <span class="custom_card-value">${c(a)}</span>
      <span class="custom_card-subtext" style="color: ${f};">
        ${k} vs ${((y=h.find(d=>d.value===o.value))==null?void 0:y.label)||"N/A"}
      </span>
    </div>
  `}async function w(){_.board("dashboard_free",{gui:{layouts:[{rows:[{cells:[{id:"row-1",layout:{rows:[{cells:[{id:"card-api-calls-free"},{id:"card-customers-free"}]}]}}]}]}]},components:[{type:"HTML",renderTo:"card-api-calls-free",html:l("Free API Calls left this month",e.free_data.left_free_api_calls,0,!1)},{type:"HTML",renderTo:"card-customers-free",html:l("Customers",e.free_data.customer_count_change.current_period_customers,e.free_data.customer_count_change.percent_change)}]}),_.board("dashboard_container",{gui:{layouts:[{rows:[{cells:[{id:"row-1",layout:{rows:[{cells:[{id:"x",layout:{rows:[{id:"row-1-1A",cells:[{id:"card-api-calls"}]},{id:"row-1-1B",cells:[{id:"card-income"}]}]}},{id:"chart-pie"},{id:"chart-line"}]}]}}]},{id:"row-2",cells:[{id:"row-2A"},{id:"row-2B"}]}]}],enabled:!0},components:[{type:"HTML",renderTo:"card-api-calls",html:l("API Calls",e.data.api_calls.current_period_api_calls,e.data.api_calls.percent_change)},{type:"HTML",renderTo:"card-income",html:l("Income",e.data.parking_income.current_period_income,e.data.parking_income.percent_change)},{type:"Highcharts",renderTo:"chart-line",chartOptions:{chart:{type:"line"},title:{text:"Customer Trends"},xAxis:{categories:Object.keys(e.data.customers),title:{text:"Timeframe"}},yAxis:{title:{text:"Number of Customers"}},series:[{type:"line",name:"Customers",data:Object.values(e.data.customers)}]}},{type:"Highcharts",renderTo:"chart-pie",chartOptions:{chart:{type:"pie"},title:{text:"Customer Distribution"},plotOptions:{pie:{innerSize:"50%"}},series:[{type:"pie",name:"Customers",data:Object.keys(e.data.customer_distribution).map((t,a)=>({name:t,y:Number(Object.values(e.data.customer_distribution)[a])}))}]}},{type:"Highcharts",renderTo:"row-2A",chartOptions:{chart:{type:"line"},title:{text:"Average Daily Utilization"},xAxis:{categories:Object.keys(e.data.avg_utilization).length>0?Object.keys(e.data.avg_utilization[Object.keys(e.data.avg_utilization)[0]]):Object.keys(e.data.customers),title:{text:"Date"}},yAxis:{title:{text:"Utilization in %"}},series:Object.keys(e.data.avg_utilization).map(t=>({type:"line",name:t,data:Object.values(e.data.avg_utilization[t])}))}},{type:"Highcharts",renderTo:"row-2B",chartOptions:{chart:{type:"column"},title:{text:"Defect Distribution"},xAxis:{categories:Object.keys(e.data.defect_distribution),title:{text:"Properties"}},yAxis:{min:0,title:{text:"Count"},stackLabels:{enabled:!0,style:{fontWeight:"bold",color:"gray"}}},legend:{align:"right",x:-30,verticalAlign:"top",y:25,floating:!0,borderColor:"#CCC",borderWidth:1,shadow:!1},plotOptions:{column:{stacking:"normal"}},series:Object.values(v.DefectState).filter(t=>typeof t=="number").map(t=>({type:"column",name:v.DefectState[t],data:Object.keys(e.data.defect_distribution).map(a=>e.data.defect_distribution[a][t])}))}}]})}async function T(){e.setTimeframe(o.value),await e.fetchAllData()}return L(async()=>{b(()=>e.loading,async()=>{if(!e.loading&&F.currentRoute.value.name==="/[tenantId]/")try{await w()}catch(t){console.error(t)}}),b(x,t=>{document.getElementById("dashboard_free").className=`highcharts-${t?"dark":"light"}`,document.getElementById("dashboard_container").className=`highcharts-${t?"dark":"light"}`},{immediate:!0}),await e.fetchAllData()}),(t,a)=>{const s=O;return S(),B("div",null,[r($,{density:"comfortable",class:"d-flex align-center pa-1 pl-8 pr-4"},{default:u(()=>[a[2]||(a[2]=m("h1",{class:"text-h5 bold"},"Management Dashboard",-1)),r(I),g(r(P,{class:"mr-4",icon:"mdi-refresh",onClick:a[0]||(a[0]=n=>i(e).fetchAllData()),loading:i(e).loading,color:i(e).error?"error":void 0},null,8,["loading","color"]),[[R,"Refresh"]]),r(E,{vertical:"",inset:""}),r(U,{class:"pl-4","max-width":"200",density:"comfortable","hide-details":"",modelValue:o.value,"onUpdate:modelValue":[a[1]||(a[1]=n=>o.value=n),T],items:h,label:"Select Timeframe","item-title":"label"},null,8,["modelValue"])]),_:1}),r(M,{indeterminate:i(e).loading,color:i(e).error?"error":void 0},null,8,["indeterminate","color"]),g(r(N,null,{default:u(()=>[a[4]||(a[4]=m("div",{id:"dashboard_free"},null,-1)),r(s,null,{default:u(()=>a[3]||(a[3]=[m("div",{id:"dashboard_container",style:{"min-height":"100%"}},null,-1)])),_:1})]),_:1},512),[[z,!i(p).authLoading]])])}}});export{Q as default};
