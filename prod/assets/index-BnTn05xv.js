import{_ as A}from"./ProTier-BmfkYhLU.js";import{d as j,H as C,e as D,f as H,g as L,r as y,h as S,i as _,o as V,j as B,k as s,w as d,l as M,u as b,m as $,n as z,v as N,V as I,b as u,p as P,a as E,q as g,s as v}from"./index-p8F1I7Eo.js";import{V as F}from"./VSelect-hf9cPqrI.js";import"./VChip-bJK9fyN9.js";const J=j({__name:"index",setup(U){C.setOptions({chart:{styledMode:!0}});const m=D(),e=H(),x=L(()=>m.isDark),p=[{value:"weekly",label:"Last week"},{value:"monthly",label:"Last month"},{value:"yearly",label:"Last year"},{value:"total",label:"Total"}],i=y(e.timeframe),w=y(!1);function o(t,a,r,l=!0){var f;let h=r>=0?"green":"red";l||(h="transparent");const n=c=>c.toFixed(0),O=r>=0?`+${n(r)}%`:`${n(r)}%`;return`
    <div class="custom_card">
      <div class="custom_card-header">${t}</div>
      <span class="custom_card-value">${n(a)}</span>
      <span class="custom_card-subtext" style="color: ${h};">
        ${O} vs ${((f=p.find(c=>c.value===i.value))==null?void 0:f.label)||"N/A"}
      </span>
    </div>
  `}async function T(){g.board("dashboard_free",{gui:{layouts:[{rows:[{cells:[{id:"row-1",layout:{rows:[{cells:[{id:"card-api-calls-free"},{id:"card-customers-free"}]}]}}]}]}]},components:[{type:"HTML",renderTo:"card-api-calls-free",html:o("Free API Calls left this month",e.free_data.left_free_api_calls,0,!1)},{type:"HTML",renderTo:"card-customers-free",html:o("Customers",e.free_data.customer_count_change.current_period_customers,e.free_data.customer_count_change.percent_change)}]}),g.board("dashboard_container",{gui:{layouts:[{rows:[{cells:[{id:"row-1",layout:{rows:[{cells:[{id:"x",layout:{rows:[{id:"row-1-1A",cells:[{id:"card-api-calls"}]},{id:"row-1-1B",cells:[{id:"card-income"}]}]}},{id:"chart-pie"},{id:"chart-line"}]}]}}]},{id:"row-2",cells:[{id:"row-2A"},{id:"row-2B"}]}]}],enabled:!0},components:[{type:"HTML",renderTo:"card-api-calls",html:o("API Calls",e.data.api_calls.current_period_api_calls,e.data.api_calls.percent_change)},{type:"HTML",renderTo:"card-income",html:o("Income",e.data.parking_income.current_period_income,e.data.parking_income.percent_change)},{type:"Highcharts",renderTo:"chart-line",chartOptions:{chart:{type:"line"},title:{text:"Customer Trends"},xAxis:{categories:Object.keys(e.data.customers),title:{text:"Timeframe"}},yAxis:{title:{text:"Number of Customers"}},series:[{type:"line",name:"Customers",data:Object.values(e.data.customers)}]}},{type:"Highcharts",renderTo:"chart-pie",chartOptions:{chart:{type:"pie"},title:{text:"Customer Distribution"},plotOptions:{pie:{innerSize:"50%"}},series:[{type:"pie",name:"Customers",data:Object.keys(e.data.customer_distribution).map((t,a)=>({name:t,y:Number(Object.values(e.data.customer_distribution)[a])}))}]}},{type:"Highcharts",renderTo:"row-2A",chartOptions:{chart:{type:"line"},title:{text:"Average Daily Utilization"},xAxis:{categories:Object.keys(e.data.avg_utilization).length>0?Object.keys(e.data.avg_utilization[Object.keys(e.data.avg_utilization)[0]]):Object.keys(e.data.customers),title:{text:"Date"}},yAxis:{title:{text:"Utilization in %"}},series:Object.keys(e.data.avg_utilization).map(t=>({type:"line",name:t,data:Object.values(e.data.avg_utilization[t])}))}},{type:"Highcharts",renderTo:"row-2B",chartOptions:{chart:{type:"column"},title:{text:"Defect Distribution"},xAxis:{categories:Object.keys(e.data.defect_distribution),title:{text:"Properties"}},yAxis:{min:0,title:{text:"Count"},stackLabels:{enabled:!0,style:{fontWeight:"bold",color:"gray"}}},legend:{align:"right",x:-30,verticalAlign:"top",y:25,floating:!0,borderColor:"#CCC",borderWidth:1,shadow:!1},plotOptions:{column:{stacking:"normal"}},series:Object.values(v.DefectState).filter(t=>typeof t=="number").map(t=>({type:"column",name:v.DefectState[t],data:Object.keys(e.data.defect_distribution).map(a=>e.data.defect_distribution[a][t])}))}}]})}async function k(){e.setTimeframe(i.value),await e.fetchAllData()}return S(async()=>{_(()=>e.loading,async()=>{if(!e.loading&&E.currentRoute.value.name==="/[tenantId]/")try{await T()}catch(t){console.error(t)}}),_(x,t=>{document.getElementById("dashboard_free").className=`highcharts-${t?"dark":"light"}`,document.getElementById("dashboard_container").className=`highcharts-${t?"dark":"light"}`},{immediate:!0}),await e.fetchAllData()}),(t,a)=>{const r=A;return V(),B("div",null,[s(M,{density:"comfortable",class:"d-flex align-center pa-1 pl-8 pr-4"},{default:d(()=>[a[1]||(a[1]=u("h1",{class:"text-h5 bold"},"Management Dashboard",-1)),s(P),s(F,{"max-width":"200",density:"comfortable","hide-details":"",modelValue:i.value,"onUpdate:modelValue":[a[0]||(a[0]=l=>i.value=l),k],items:p,label:"Select Timeframe","item-title":"label"},null,8,["modelValue"])]),_:1}),s($,{indeterminate:b(e).loading,color:w.value?"error":void 0},null,8,["indeterminate","color"]),z(s(I,null,{default:d(()=>[a[3]||(a[3]=u("div",{id:"dashboard_free"},null,-1)),s(r,null,{default:d(()=>a[2]||(a[2]=[u("div",{id:"dashboard_container",style:{"min-height":"100%"}},null,-1)])),_:1})]),_:1},512),[[N,!b(m).authLoading]])])}}});export{J as default};
