import{d as K,k as I,_ as G,o as c,c as U,z as ie,A as Ve,g as J,i as ae,r as u,B as be,w as l,m as o,C as le,D as ce,E as S,t as O,F as ue,G as Se,I as xe,J as B,K as ye,L as z,b,y as P,M as fe,s as me,x as k,N as ne,O as pe,u as ve,l as w,q as N,T as R,P as Ce,Q as ge,R as we,S as X,U as se,W as de,X as Z,Y as ke,Z as $,V as Ie,$ as ee,a0 as te,a1 as oe,a2 as Ue,a3 as Ae,a4 as Fe}from"./index-CjQqTXA-.js";import{V as T,a as Ne}from"./VChip-DwrP_BKx.js";import{V as Re,a as F}from"./VRow-CTiobtic.js";import{V as Ee}from"./VTextarea-CYt7mZ3k.js";import{V as Oe}from"./VSelect-DTQyHLJK.js";import{V as Le}from"./VFileInput-bYHvBDW7.js";import{u as Te}from"./index-DH0F4sri.js";import{V as Pe}from"./VDataTable-BLzx_pEm.js";import"./VPagination-DNRpBwm-.js";const je=K({__name:"StatusChip",props:{defect:{type:Object,required:!0}},setup(y,{expose:t}){t();function g(f){switch(f){case I.DefectState.OPEN:return"Open";case I.DefectState.IN_WORK:return"In Work";case I.DefectState.REJECTED:return"Rejected";case I.DefectState.DONE:return"Done";default:return"Unknown"}}function e(f){switch(f){case I.DefectState.OPEN:return"green";case I.DefectState.IN_WORK:return"blue";case I.DefectState.REJECTED:return"red";case I.DefectState.DONE:return"grey";default:return"black"}}const n={toStatusText:g,toStatusColor:e};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}});function qe(y,t,g,e,n,f){return c(),U(T,{color:e.toStatusColor(g.defect.status),text:e.toStatusText(g.defect.status),class:"text-uppercase",size:"small",label:""},null,8,["color","text"])}const De=G(je,[["render",qe],["__file","/home/runner/work/cloud-porsche/cloud-porsche/cloud-dev-ui/src/components/StatusChip.vue"]]),We=K({__name:"AddDefectPopup",props:ie({defect:{type:Object,required:!0},patch:{type:Boolean,required:!0}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:ie(["save","patch","close"],["update:modelValue"]),setup(y,{expose:t,emit:g}){t();const e=Ve(y,"modelValue"),n=y,f=J(()=>n.defect),s=J(()=>n.patch??!1);ae(f,()=>{D.value=n.defect.name??"",a.value=n.defect.location??"",r.value=n.defect.descriptionShort??"",m.value=n.defect.descriptionLong??"",h.value=n.defect.reportedDate?new Date(n.defect.reportedDate):new Date,L.value=n.defect.status,v.value=n.defect.image?new File([],n.defect.image,{type:"image/png"}):void 0});const D=u(n.defect.name??""),a=u(n.defect.location??""),r=u(n.defect.descriptionShort??""),m=u(n.defect.descriptionLong??""),h=u(n.defect.reportedDate?new Date(n.defect.reportedDate):new Date),v=u(n.defect.image?new File([],n.defect.image,{type:"image/png"}):void 0),L=u(n.defect.status),x=u(!1),_=p=>!!p||"This field is required.",A=g;function H(){x.value&&q()}const j=[p=>!p||!p.length||p[0].size<2e6||"File size should be less than 2MB",p=>!p||!p.length||p[0].type.startsWith("image/")||"File must be an image"];function q(){var E;const p={name:D.value,location:a.value,descriptionShort:r.value,descriptionLong:m.value,reportedDate:Y(h.value),image:v.value?v.value.name===n.defect.image?n.defect.image:crypto.randomUUID()+"."+((E=v.value)==null?void 0:E.name.split(".").pop()):""};s.value?A("patch",[{...p,status:L.value},v.value,n.defect.image]):A("save",p,v.value),W()}function W(){e.value=!1}function Y(p){const E=p.getTimezoneOffset();return new Date(p.getTime()-E*60*1e3)}const M={dialog:e,props:n,defectSubscription:f,patchSubscription:s,defectName:D,location:a,shortDescription:r,longDescription:m,defectDate:h,imageFile:v,status:L,valid:x,required:_,emit:A,validateForm:H,fileRules:j,saveDefect:q,closeDialog:W,toGmt0:Y,get DefectState(){return I.DefectState}};return Object.defineProperty(M,"__isScriptSetup",{enumerable:!1,value:!0}),M}});function Ye(y,t,g,e,n,f){const s=be("v-date-input"),D=De;return c(),U(ne,{modelValue:e.dialog,"onUpdate:modelValue":t[8]||(t[8]=a=>e.dialog=a),"max-width":"600"},{default:l(()=>[o(le,null,{default:l(()=>[o(ce,null,{default:l(()=>[S(O(e.patchSubscription?"Change":"Add New")+" Defect ",1)]),_:1}),o(ue,null,{default:l(()=>[o(Se,{modelValue:e.valid,"onUpdate:modelValue":t[7]||(t[7]=a=>e.valid=a),onSubmit:xe(e.validateForm,["prevent"])},{default:l(()=>[o(Re,{dense:""},{default:l(()=>[o(F,{cols:"12",md:"6"},{default:l(()=>[o(B,{label:"Defect Name*",modelValue:e.defectName,"onUpdate:modelValue":t[0]||(t[0]=a=>e.defectName=a),rules:[e.required]},null,8,["modelValue","rules"])]),_:1}),o(F,{cols:"12",md:"6"},{default:l(()=>[o(B,{label:"Location*",modelValue:e.location,"onUpdate:modelValue":t[1]||(t[1]=a=>e.location=a),rules:[e.required]},null,8,["modelValue","rules"])]),_:1}),o(F,{cols:"12"},{default:l(()=>[o(B,{label:"Short Description*",modelValue:e.shortDescription,"onUpdate:modelValue":t[2]||(t[2]=a=>e.shortDescription=a),rules:[e.required]},null,8,["modelValue","rules"])]),_:1}),o(F,{cols:"12"},{default:l(()=>[o(Ee,{label:"Long Description*",modelValue:e.longDescription,"onUpdate:modelValue":t[3]||(t[3]=a=>e.longDescription=a),rules:[e.required]},null,8,["modelValue","rules"])]),_:1}),o(F,{cols:e.patchSubscription?6:12},{default:l(()=>[o(s,{label:"Select a date*",modelValue:e.defectDate,"onUpdate:modelValue":t[4]||(t[4]=a=>e.defectDate=a),rules:[e.required]},null,8,["modelValue","rules"])]),_:1},8,["cols"]),e.patchSubscription?(c(),U(F,{key:0,cols:"6"},{default:l(()=>[o(Oe,{label:"Status",items:[e.DefectState.OPEN,e.DefectState.IN_WORK,e.DefectState.DONE,e.DefectState.REJECTED],modelValue:e.status,"onUpdate:modelValue":t[5]||(t[5]=a=>e.status=a)},{selection:l(({item:a})=>[o(D,{defect:{status:a.raw}},null,8,["defect"])]),item:l(({props:a,item:r})=>[o(ye,{props:a,onClick:a.onClick},{default:l(()=>[o(D,{defect:{status:r.raw}},null,8,["defect"])]),_:2},1032,["props","onClick"])]),_:1},8,["items","modelValue"])]),_:1})):z("",!0),o(F,{cols:"12"},{default:l(()=>[o(Le,{label:"Upload Image",rules:e.fileRules,"validate-on":"eager",modelValue:e.imageFile,"onUpdate:modelValue":t[6]||(t[6]=a=>e.imageFile=a),accept:"image/*","prepend-icon":"mdi-image"},null,8,["modelValue"])]),_:1})]),_:1}),t[9]||(t[9]=b("small",{class:"text-caption"},"*indicates required field",-1))]),_:1},8,["modelValue"])]),_:1}),o(P),o(fe,null,{default:l(()=>[o(me),o(k,{text:"Cancel",onClick:e.closeDialog},{default:l(()=>t[10]||(t[10]=[S("Cancel")])),_:1}),o(k,{disabled:!e.valid,color:"primary",onClick:e.validateForm},{default:l(()=>t[11]||(t[11]=[S(" Save ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const Me=G(We,[["render",Ye],["__file","/home/runner/work/cloud-porsche/cloud-porsche/cloud-dev-ui/src/components/AddDefectPopup.vue"]]),Be=K({__name:"SearchFilter",props:{loading:{type:Boolean,required:!0},error:{type:Boolean,required:!0}},emits:["updateList","refresh","add","deleteAllDone"],setup(y,{expose:t,emit:g}){t();const{mobile:e}=pe(),n=u(""),f=u("name"),s=g,D=y,a=J(()=>D.error);function r(){h()}function m(){h()}function h(){s("updateList",n.value,f.value)}const v={mobile:e,search:n,filter:f,emit:s,props:D,error:a,onInputChange:r,onFilterChange:m,emitUpdate:h,get useAppStore(){return ve}};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}}),ze={class:"d-flex w-100 pb-1"};function Je(y,t,g,e,n,f){return c(),w(ge,null,[b("h1",ze,[t[6]||(t[6]=S(" Defects ")),o(me),N(o(k,{"prepend-icon":e.mobile?void 0:"mdi-delete",icon:e.mobile?"mdi-delete":void 0,onClick:t[0]||(t[0]=s=>e.emit("deleteAllDone")),class:"me-2",text:e.mobile?"":"Clear all done",disabled:e.useAppStore().isUserRole},null,8,["prepend-icon","icon","text","disabled"]),[[R,e.useAppStore().isUserRole?"Not enough permissions!":"Clear all done"]]),N(o(k,{"prepend-icon":e.mobile?void 0:"mdi-plus",icon:e.mobile?"mdi-plus":void 0,onClick:t[1]||(t[1]=s=>e.emit("add")),class:"me-2",text:e.mobile?"":"Add Defect",disabled:e.useAppStore().isUserRole},null,8,["prepend-icon","icon","text","disabled"]),[[R,e.useAppStore().isUserRole?"Not enough permissions!":"Add Defect"]]),N(o(k,{"prepend-icon":e.mobile?void 0:"mdi-refresh",icon:e.mobile?"mdi-refresh":void 0,onClick:t[2]||(t[2]=s=>e.emit("refresh")),loading:g.loading,color:e.error?"error":"primary",text:e.mobile?"":"Refresh"},null,8,["prepend-icon","icon","loading","color","text"]),[[R,"Refresh"]])]),o(P,{class:"pa-1",thickness:"0"}),o(B,{loading:g.loading,modelValue:e.search,"onUpdate:modelValue":t[3]||(t[3]=s=>e.search=s),density:"comfortable",label:"Search","prepend-inner-icon":"mdi-magnify",variant:"solo-filled",flat:"","hide-details":"","single-line":"",onInput:e.onInputChange,onKeydown:Ce(e.onInputChange,["enter"]),clearable:"","onClick:clear":t[4]||(t[4]=s=>{e.search="",e.onInputChange()}),error:e.error},null,8,["loading","modelValue","error"]),o(P,{class:"pa-1",thickness:"0"}),o(Ne,{filter:"",modelValue:e.filter,"onUpdate:modelValue":t[5]||(t[5]=s=>e.filter=s),"selected-class":"text-primary",mandatory:"",onChange:e.onFilterChange},{default:l(()=>[o(T,{text:"ID",value:"id",variant:"outlined"}),o(T,{text:"Name",value:"name",variant:"outlined"}),o(T,{text:"Location",value:"location",variant:"outlined"}),N(o(T,{text:"Date",value:"reportedDate",variant:"outlined"},null,512),[[R,"e.g. YYYY-MM-DD"]])]),_:1},8,["modelValue"]),o(P,{class:"pa-1",thickness:"0"})],64)}const Ke=G(Be,[["render",Je],["__file","/home/runner/work/cloud-porsche/cloud-porsche/cloud-dev-ui/src/components/SearchFilter.vue"]]),Ge=K({__name:"[id]",setup(y,{expose:t}){t();const{mobile:g}=pe(),e=u(!0),n=u(!1),f=u([]),s=u(!1),D=u(!1),a=we(),r=J(()=>a.params.id),m=u({open:!1,src:void 0});ae(s,i=>{i||j()});const h=u({}),v=u(void 0),L=[{title:"ID",value:"id",sortable:!0,maxWidth:"100px"},{title:"Name",value:"name",sortable:!0,maxWidth:"100px",nowrap:!0},{title:"Location",value:"location",sortable:!0,maxWidth:"100px",nowrap:!0},{title:"Description Short",value:"descriptionShort",sortable:!0,maxWidth:"120px",nowrap:!0},{title:"Description Long",value:"descriptionLong",sortable:!0,maxWidth:"100px",nowrap:!0},{title:"Reported Date",value:"reportedDate",nowrap:!0},{title:"Status",value:"status",sortable:!0,maxWidth:"100px"},{title:"Image",value:"signedImage",sortable:!1,nowrap:!0,maxWidth:"150px"},{title:"Actions",value:"actions",sortable:!1,nowrap:!0,maxWidth:"100px"}];_(),ae(r,()=>{_()});function x(i){e.value=!1,n.value=!0}function _(){if(!r.value){console.error("Property ID is missing");return}e.value=!0,X(`/v1/defects?propertyId=${r.value}`).json().then(async i=>{f.value=await Promise.all(i.map(async d=>(d.signedImage=await A(d.image),d))),e.value=!1,n.value=!1}).catch(x)}async function A(i){if(!i)return"";try{const d=await X(`/v1/storage/${i}`);if(!d.ok)throw new Error("Failed to fetch signed URL");const{signedUrl:C}=await d.json();return C}catch(d){return console.error("Error fetching signed URL:",d),""}}function H(){s.value=!0}function j(){s.value=!1,setTimeout(()=>h.value={},100)}function q(i){h.value=i,s.value=!0}function W(i){if(!i){console.error("No defect to delete");return}v.value=i,D.value=!0}function Y(i,d){if(i.propertyId=r.value,e.value=!0,d){const C=new File([d],i.image,{type:d.type}),V=new FormData;V.append("file",C),se("/v1/storage/upload",V).then(()=>de("/v1/defects",i).then(()=>{_()})).catch(x)}else de("/v1/defects",i).then(()=>{_()}).catch(x);s.value=!1}function M(i,d){if(!r.value){console.error("Property ID is missing");return}e.value=!0,X(`/v1/defects/search?search=${i}&filter=${d}&propertyId=${r.value}`).json().then(async C=>{f.value=await Promise.all(C.map(async V=>(V.signedImage=await A(V.image),V))),e.value=!1,n.value=!1}).catch(x)}function p(i){e.value=!0,Z(`/v1/defects/${i}`).then(()=>{_()}),D.value=!1}function E(){e.value=!0,Z(`/v1/defects/clearAllDone?propertyId=${r.value}`).then(()=>{_()})}function he(i,d,C,V){if(e.value=!0,C&&d.image&&V!==d.image){const _e=new File([C],d.image,{type:C.type}),Q=new FormData;Q.append("file",_e),(V?ke(`/v1/storage/upload/${V}`,Q):se("/v1/storage/upload",Q)).then(()=>$(`/v1/defects/${i}`,d).then(()=>{_()})).catch(x)}else!C&&V?Z(`/v1/storage/${V}`).then(()=>{$(`/v1/defects/${i}`,d).then(()=>{_()})}).catch(x):$(`/v1/defects/${i}`,d).then(()=>{_()}).catch(x)}const re={mobile:g,loading:e,error:n,defects:f,dialog:s,confirmDialog:D,route:a,id:r,inspectedImage:m,activeDefect:h,toDelete:v,headers:L,errHandler:x,refetch:_,fetchImage:A,openDialog:H,closeDialog:j,editDialog:q,initiateDeletion:W,handleSave:Y,handleUpdateList:M,deleteDefect:p,deleteAllDone:E,patchDefect:he,StatusChip:De,get useDateFormat(){return Te},get useAppStore(){return ve}};return Object.defineProperty(re,"__isScriptSetup",{enumerable:!1,value:!0}),re}}),He={class:"d-flex align-center justify-center fill-height"},Qe={class:"d-flex align-center justify-center fill-height"},Xe=["colspan"],Ze={key:0},$e={key:1},et={key:2},tt={class:"d-flex align-center justify-start fill-height"},ot={class:"d-flex align-center justify-start fill-height"},at={key:1},lt={key:3},nt={key:4},rt={class:"d-flex flex-column align-center justify-center fill-height"},it={class:"d-flex align-center justify-center fill-height"};function st(y,t,g,e,n,f){const s=Ke,D=Me;return c(),w("div",null,[o(Ie,null,{default:l(()=>[o(s,{onUpdateList:e.handleUpdateList,onRefresh:t[0]||(t[0]=a=>e.refetch()),onAdd:e.openDialog,onDeleteAllDone:e.deleteAllDone,error:e.error,loading:e.loading},null,8,["error","loading"]),o(Pe,{class:"data-table rounded",mobile:e.mobile,density:"comfortable","no-data-text":e.error?"A network error occurred ⚡":"No defects found",items:e.defects,headers:e.headers,"items-per-page-options":[{value:5,title:"5"},{value:10,title:"10"},{value:25,title:"25"},{value:-1,title:"All"}],"show-expand":"","multi-sort":""},{"item.status":l(({item:a})=>[o(e.StatusChip,{defect:a},null,8,["defect"])]),"item.reportedDate":l(({item:a})=>[S(O(e.useDateFormat(a.reportedDate,"MM.DD.YYYY")),1)]),"item.signedImage":l(({item:a})=>{var r;return[((r=a.signedImage)==null?void 0:r.length)>0?(c(),U(oe,{key:0,src:a.signedImage,class:"cursor-pointer","aspect-ratio":"1",contain:"",onClick:m=>e.inspectedImage={open:!0,src:a.signedImage}},{error:l(()=>[b("div",He,[o(ee,{color:"error",icon:"mdi-image-broken-variant"})])]),placeholder:l(()=>[b("div",Qe,[o(te,{size:"24",indeterminate:""})])]),_:2},1032,["src","onClick"])):z("",!0)]}),"item.actions":l(({item:a})=>[N(o(k,{icon:"mdi-pencil",onClick:r=>e.editDialog(a),variant:"plain",disabled:e.useAppStore().isUserRole},null,8,["onClick","disabled"]),[[R,e.useAppStore().isUserRole?"Not enough permissions!":"Edit"]])]),"expanded-row":l(({columns:a,item:r})=>[b("tr",null,[b("td",{colspan:a.length,class:"pa-5"},[(c(!0),w(ge,null,Ue(a,m=>{var h;return c(),w("div",{key:m.value,class:"expanded-defect pa-2"},[b("strong",null,O(m.title),1),m.value==="reportedDate"?(c(),w("div",Ze,O(e.useDateFormat(r.reportedDate,"MM.DD.YYYY HH:mm")),1)):m.value==="status"?(c(),w("div",$e,[o(e.StatusChip,{defect:r},null,8,["defect"])])):m.value==="signedImage"?(c(),w("div",et,[((h=r.signedImage)==null?void 0:h.length)>0?(c(),U(oe,{key:0,src:r.signedImage,class:"cursor-pointer",contain:"",position:"left","max-height":"300",onClick:v=>e.inspectedImage={open:!0,src:r.signedImage}},{error:l(()=>[b("div",tt,[N(o(ee,{color:"error",size:"50",icon:"mdi-image-broken-variant"},null,512),[[R,"Corrupted or missing Image"]])])]),placeholder:l(()=>[b("div",ot,[o(te,{indeterminate:""})])]),_:2},1032,["src","onClick"])):(c(),w("i",at,"No image."))])):m.value==="actions"?(c(),w("div",lt,[N((c(),U(k,{"prepend-icon":"mdi-pencil",class:"me-2",onClick:v=>e.editDialog(r),variant:"tonal",disabled:e.useAppStore().isUserRole},{default:l(()=>[...t[8]||(t[8]=[S("Edit ")])]),_:2},1032,["onClick","disabled"])),[[R,e.useAppStore().isUserRole?"Not enough permissions!":"Edit"]]),o(k,{"prepend-icon":"mdi-delete",color:"error",onClick:v=>e.initiateDeletion(r),variant:"flat",disabled:e.useAppStore().isUserRole},{default:l(()=>[t[9]||(t[9]=S("Delete ")),o(Fe,{disabled:!e.useAppStore().isUserRole,activator:"parent",text:"Not enough permissions!"},null,8,["disabled"])]),_:2},1032,["onClick","disabled"])])):(c(),w("div",nt,O(r[m.value]),1)),m.title!==""?(c(),U(P,{key:5,class:"mt-2"})):z("",!0)])}),128))],8,Xe)])]),_:1},8,["mobile","no-data-text","items"]),o(ne,{modelValue:e.inspectedImage.open,"onUpdate:modelValue":t[2]||(t[2]=a=>e.inspectedImage.open=a),"max-width":"50%","max-height":"80%"},{default:l(()=>[o(le,{rounded:"",class:"d-flex flex-row overflow-hidden"},{default:l(()=>[e.inspectedImage.src?(c(),U(oe,{key:0,src:e.inspectedImage.src,contain:"","max-height":"100%","min-height":"300",rounded:"",onClick:t[1]||(t[1]=a=>e.inspectedImage={open:!1,src:void 0})},{error:l(()=>[b("div",rt,[o(ee,{color:"error",size:"100",icon:"mdi-image-broken-variant"}),t[10]||(t[10]=b("i",{class:"pa-2 text-red-lighten-3"},"Corrupted or missing Image.",-1))])]),placeholder:l(()=>[b("div",it,[o(te,{indeterminate:""})])]),_:1},8,["src"])):z("",!0)]),_:1})]),_:1},8,["modelValue"]),o(D,{modelValue:e.dialog,"onUpdate:modelValue":t[3]||(t[3]=a=>e.dialog=a),defect:e.activeDefect,patch:!!e.activeDefect.id,onSave:e.handleSave,onPatch:t[4]||(t[4]=a=>e.patchDefect(e.activeDefect.id,a[0],a[1],a[2]))},null,8,["modelValue","defect","patch"])]),_:1}),o(ne,{modelValue:e.confirmDialog,"onUpdate:modelValue":t[7]||(t[7]=a=>e.confirmDialog=a),"max-width":"400"},{default:l(()=>[o(le,null,{default:l(()=>[o(ce,null,{default:l(()=>t[11]||(t[11]=[S("Confirm Delete")])),_:1}),o(Ae,null,{default:l(()=>[S("Defect name: "+O(e.toDelete.name),1)]),_:1}),o(ue,null,{default:l(()=>t[12]||(t[12]=[S("Are you sure you want to delete this defect?")])),_:1}),o(fe,null,{default:l(()=>[o(k,{variant:"text",onClick:t[5]||(t[5]=a=>e.confirmDialog=!1)},{default:l(()=>t[13]||(t[13]=[S("Cancel")])),_:1}),o(k,{color:"error",variant:"flat",onClick:t[6]||(t[6]=a=>e.deleteDefect(e.toDelete.id)),autofocus:""},{default:l(()=>t[14]||(t[14]=[S(" Delete ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const ht=G(Ge,[["render",st],["__file","/home/runner/work/cloud-porsche/cloud-porsche/cloud-dev-ui/src/pages/[tenantId]/defects/[id].vue"]]);export{ht as default};
