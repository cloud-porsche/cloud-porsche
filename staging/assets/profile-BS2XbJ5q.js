import{a5 as ne,a6 as re,a7 as ie,a8 as de,a9 as ue,aa as ce,ab as me,ac as fe,m as l,d as pe,u as ve,ad as ge,ae as ye,g as Ve,r as p,af as Ce,i as De,a as F,S as we,ag as B,X as L,ah as xe,U as be,ai as he,_ as ke,l as R,c as x,w as o,L as S,o as c,aj as M,b as i,ak as _e,a1 as Ue,$ as q,a0 as Pe,E as r,y as b,q as z,T as W,t as C,x as V,M as G,C as E,D as J,a3 as Re,F as X,G as Y,J as H,N as K,al as Ae,s as Ne,p as Fe}from"./index-CjQqTXA-.js";import{V as Le}from"./VFileInput-bYHvBDW7.js";import{V as Se,a as Q}from"./VRow-CTiobtic.js";import"./VChip-DwrP_BKx.js";const Ee=ne({fluid:{type:Boolean,default:!1},...re(),...ie(),...de()},"VContainer"),Ie=ue()({name:"VContainer",props:Ee(),setup(v,a){let{slots:g}=a;const{rtlClasses:e}=ce(),{dimensionStyles:D}=me(v);return fe(()=>l(v.tag,{class:["v-container",{"v-container--fluid":v.fluid},e.value,v.class],style:[D.value,v.style]},g)),{}}}),Oe=pe({__name:"profile",async setup(v,{expose:a}){var T,j;a();let g,e;const D=ve(),m=ge(),t=ye(),f=Ve(()=>F.currentRoute.value.params.tenantId),y=p(!1),d=p({displayName:((T=t.value)==null?void 0:T.displayName)??"",photo:null}),h=p(!1),k=p(!1),w=p(null);(j=t.value)!=null&&j.photoURL&&(w.value=([g,e]=Ce(()=>_(t.value.photoURL)),g=await g,e(),g)),De(t,async s=>{if(s){w.value=s.photoURL?await _(s.photoURL):null;const n=F.currentRoute.value.query.redirect;n&&F.push({path:n})}});const A=p(""),Z=()=>{y.value=!0},$=()=>{var s;y.value=!1,d.value.displayName=((s=t.value)==null?void 0:s.displayName)??""},ee=async()=>{var s,n;try{if(t.value&&m){let u="",N="";if(d.value.photo){N+=d.value.photo.name.split(".").pop(),u=t.value.uid+"."+N;const se=new File([d.value.photo],u,{type:d.value.photo.type});await I(se),w.value&&((s=t.value.photoURL)==null?void 0:s.split(".").pop())!=N&&!((n=t.value.photoURL)!=null&&n.startsWith("http"))&&await L("/v1/storage/"+t.value.photoURL)}await xe(t.value,{displayName:d.value.displayName,photoURL:u!==""?u:t.value.photoURL}),u&&(w.value=await _(u))}y.value=!1,A.value="Profile updated!"}catch(u){console.error("Failed to update profile:",u)}};async function _(s){if(!s)return"";if(s.startsWith("http"))return s;try{const n=await we(`/v1/storage/${s}`);if(!n.ok)throw new Error("Failed to fetch signed URL");const{signedUrl:u}=await n.json();return u}catch(n){return console.error("Error fetching signed URL:",n),""}}const I=async s=>{try{const n=new FormData;n.append("file",s),await be("/v1/storage/upload",n)}catch(n){console.error("Failed to upload photo:",n)}};function ae(){var s;(s=t.value)!=null&&s.email&&he(m,t.value.email).then(()=>{A.value="Password reset email sent!"}).catch(n=>{console.error("Error sending reset email:",n)})}const U=p(!1),P=p(""),te=async()=>{var s;P.value===f.value&&!["free","free-tier"].includes(f.value)&&(D.hasAdminAccess?await L(`/v1/tenants/${f.value}`,void 0,"tenantManagement"):await L(`/v1/tenants/${f.value}/users/${(s=m==null?void 0:m.currentUser)==null?void 0:s.uid}`,void 0,"tenantManagement"),await B(m),U.value=!1,P.value="")};function le(){U.value=!0}function oe(){U.value=!1,P.value=""}const O={appStore:D,auth:m,user:t,tenantId:f,editDialog:y,editData:d,formValid:h,deleteFormValid:k,userPhoto:w,successMessage:A,openEditDialog:Z,closeEditDialog:$,saveChanges:ee,fetchImage:_,uploadPhoto:I,resetPassword:ae,deleteDialogOpen:U,deleteConfirm:P,confirmDelete:te,openDeleteDialog:le,closeDeleteDialog:oe,get signOut(){return B}};return Object.defineProperty(O,"__isScriptSetup",{enumerable:!1,value:!0}),O}}),Te={for:"pb-upload"},je={class:"d-flex align-center justify-center fill-height"},Be={class:"d-flex align-center justify-center fill-height"},Me={class:"card-grid"},qe={class:"d-flex align-center"},ze={key:0},We={class:"d-flex justify-center text-center pa-2 text-body-2"},Ge={class:"text-body-1"};function Je(v,a,g,e,D,m){return c(),R("div",null,[e.appStore.authLoading?(c(),x(Fe,{key:0,indeterminate:"",color:"primary"})):e.user?(c(),x(Ie,{key:1,class:"d-flex justify-center align-center"},{default:o(()=>[l(E,{class:"pa-4",width:"fit-content","min-width":"50%",loading:e.appStore.authLoading},{default:o(()=>[l(M,{class:"d-flex justify-center"},{default:o(()=>[i("label",Te,[l(_e,{id:"pb",class:"rounded-circle bg-primary",size:"120",text:"User Photo",rounded:"",border:""},{default:o(()=>[e.userPhoto?(c(),x(Ue,{key:0,src:e.userPhoto,alt:"User Photo",cover:""},{error:o(()=>[i("div",je,[l(q,{color:"error",icon:"mdi-image-broken-variant"})])]),placeholder:o(()=>[i("div",Be,[l(Pe,{size:"24",indeterminate:""})])]),_:1},8,["src"])):(c(),x(q,{key:1,class:"opacity-80",color:"background",size:"80"},{default:o(()=>a[8]||(a[8]=[r("mdi-account ")])),_:1}))]),_:1})]),l(Le,{id:"pb-upload",class:"d-none",modelValue:e.editData.photo,"onUpdate:modelValue":[a[0]||(a[0]=t=>e.editData.photo=t),e.saveChanges],accept:"image/*","prepend-icon":"mdi-camera","max-width":"400"},null,8,["modelValue"])]),_:1}),l(b,{class:"ma-4"}),l(M,null,{default:o(()=>{var t,f,y,d,h,k;return[i("div",Me,[a[9]||(a[9]=i("span",{class:"text-end"},"Display Name:",-1)),z((c(),R("span",qe,[r(C(((t=e.user)==null?void 0:t.displayName)??"Anonymous")+" ",1),l(V,{class:"ms-2",color:"primary",onClick:e.openEditDialog,size:"x-small",icon:"mdi-pencil",variant:"tonal"})])),[[W,(f=e.user)!=null&&f.displayName?{text:(y=e.user)==null?void 0:y.displayName,openOnClick:!0,persistent:!1}:void 0,"bottom"]]),a[10]||(a[10]=i("span",{class:"text-end"},"Email:",-1)),z((c(),R("span",null,[r(C(((d=e.user)==null?void 0:d.email)??"No Email"),1)])),[[W,(h=e.user)!=null&&h.email?{text:(k=e.user)==null?void 0:k.email,openOnClick:!0,persistent:!1}:void 0,"bottom"]])])]}),_:1}),l(b,{class:"ma-4"}),l(G,null,{default:o(()=>[l(Se,null,{default:o(()=>[l(Q,{class:"text-end"},{default:o(()=>[l(V,{color:"warn",variant:"tonal",onClick:e.resetPassword},{default:o(()=>a[11]||(a[11]=[r("Reset Password ")])),_:1})]),_:1}),l(Q,null,{default:o(()=>[l(V,{color:"error",onClick:a[1]||(a[1]=t=>e.signOut(e.auth)),variant:"tonal","append-icon":"mdi-logout"},{default:o(()=>a[12]||(a[12]=[r("Log Out ")])),_:1})]),_:1})]),_:1})]),_:1}),["free","free-tier"].includes(e.tenantId)?S("",!0):(c(),R("div",ze,[l(b,{class:"ma-4"}),i("span",We,[l(V,{text:"Delete Account",variant:"text",size:"8",color:"error",flat:"",onClick:e.openDeleteDialog})])]))]),_:1},8,["loading"]),l(K,{modelValue:e.deleteDialogOpen,"onUpdate:modelValue":a[4]||(a[4]=t=>e.deleteDialogOpen=t),"max-width":"fit-content",onAfterLeave:e.closeDeleteDialog},{default:o(()=>[l(E,{class:"pa-4"},{default:o(()=>[l(J,null,{default:o(()=>[r("Delete "+C(e.appStore.hasAdminAccess&&!["free","free-tier"].includes(e.tenantId)?"Tenant":"Account"),1)]),_:1}),l(b,{class:"pb-4"}),l(Re,null,{default:o(()=>[i("p",Ge,[r(C(e.appStore.hasAdminAccess&&!["free","free-tier"].includes(e.tenantId)?"WARNING! You are about to delete your whole Subscription and all associated data with it!":"Are you sure you want to delete your account?")+" ",1),a[13]||(a[13]=i("br",null,null,-1)),a[14]||(a[14]=i("br",null,null,-1)),a[15]||(a[15]=r(" This action cannot be undone. ")),a[16]||(a[16]=i("br",null,null,-1)),a[17]||(a[17]=r(" Confirm key: ")),i("b",null,C(e.tenantId),1)])]),_:1}),l(X,null,{default:o(()=>[l(Y,{ref:"deleteForm",modelValue:e.deleteFormValid,"onUpdate:modelValue":a[3]||(a[3]=t=>e.deleteFormValid=t)},{default:o(()=>[l(H,{label:"Confirm deletion",modelValue:e.deleteConfirm,"onUpdate:modelValue":a[2]||(a[2]=t=>e.deleteConfirm=t),variant:"outlined",rules:[t=>!!t||"Confirm deletion needed",t=>t===e.tenantId||"Confirm key is incorrect"],required:""},null,8,["modelValue","rules"]),l(b,{class:"pa-2 mt-4"}),l(V,{color:"error",text:"true",class:"w-100",onClick:e.confirmDelete},{default:o(()=>a[18]||(a[18]=[r("Delete ")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e.successMessage?(c(),x(Ae,{key:0,closable:"",type:"success",class:"position-absolute bottom-0 ma-16"},{default:o(()=>[r(C(e.successMessage),1)]),_:1})):S("",!0),l(K,{modelValue:e.editDialog,"onUpdate:modelValue":a[7]||(a[7]=t=>e.editDialog=t),"max-width":"400",onAfterLeave:e.closeEditDialog},{default:o(()=>[l(E,null,{default:o(()=>[l(J,null,{default:o(()=>a[19]||(a[19]=[r("Edit Profile")])),_:1}),l(X,null,{default:o(()=>[l(Y,{ref:"editForm",modelValue:e.formValid,"onUpdate:modelValue":a[6]||(a[6]=t=>e.formValid=t)},{default:o(()=>[l(H,{label:"Display Name",modelValue:e.editData.displayName,"onUpdate:modelValue":a[5]||(a[5]=t=>e.editData.displayName=t),rules:[t=>!!t||"Display name is required"],required:""},null,8,["modelValue","rules"])]),_:1},8,["modelValue"])]),_:1}),l(G,null,{default:o(()=>[l(Ne),l(V,{color:"error",text:"true",onClick:e.closeEditDialog},{default:o(()=>a[20]||(a[20]=[r("Cancel ")])),_:1}),l(V,{color:"primary",text:"true",disabled:!e.formValid,onClick:e.saveChanges},{default:o(()=>a[21]||(a[21]=[r("Save ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):S("",!0)])}const Qe=ke(Oe,[["render",Je],["__file","/home/runner/work/cloud-porsche/cloud-porsche/cloud-dev-ui/src/pages/[tenantId]/profile.vue"]]);export{Qe as default};
